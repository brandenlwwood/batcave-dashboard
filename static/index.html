<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>BATCAVE // Command Center</title>
    <link rel="stylesheet" href="/css/batcave.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<!-- Animated background -->
<div class="bg-grid"></div>
<div class="scanline-overlay"></div>

<!-- Header -->
<header class="header">
    <div class="header-left">
        <div class="header-logo">
            <img src="/img/logo.png" alt="Wood Command Center" class="logo-img">
        </div>
    </div>
    <div class="header-right">
        <button class="voice-btn" id="voiceBtn" onclick="toggleVoice()" title="Talk to Alfred">
            <i class="fas fa-microphone"></i>
            <div class="voice-ring"></div>
        </button>
        <div class="status-pill" id="systemStatus">
            <div class="status-icon">
                <div class="pulse-ring"></div>
                <div class="pulse-dot"></div>
            </div>
            <span id="statusText">ONLINE</span>
        </div>
        <div class="clock-container">
            <div class="clock" id="clock"></div>
            <div class="clock-date" id="clockDate"></div>
        </div>
    </div>
</header>

<!-- Sticky News Ticker -->
<div class="news-sticky" id="news-sticky">
    <div class="news-sticky-label"><i class="fas fa-rss"></i> <span id="news-topic">INTEL</span></div>
    <div class="news-ticker-container">
        <div class="news-ticker" id="news-ticker">
            <div class="loading-placeholder" style="padding:0;font-size:11px;">Acquiring intelligence...</div>
        </div>
    </div>
    <button class="news-expand-btn" onclick="toggleNewsPanel()"><i class="fas fa-chevron-down" id="news-expand-icon"></i></button>
</div>
<div class="news-articles-panel" id="news-articles" style="display:none;"></div>

<!-- Dashboard Grid -->
<div class="dashboard">

    <!-- Cameras â€” Full Width -->
    <div class="widget" id="widget-weather" >
        <div class="widget-header" onclick="toggleWidget('widget-weather')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-cloud-bolt"></i></div>
                <span>WEATHER</span>
            </div>
            <div class="widget-header-right"><i class="fas fa-chevron-down widget-toggle-icon"></i></div>
        </div>
        <div class="widget-body">
            <div class="weather-display">
                <div class="weather-main">
                    <div class="weather-temp"><span id="wx-temp">--</span><span class="unit">Â°F</span></div>
                    <div class="weather-desc" id="wx-desc">Acquiring...</div>
                </div>
                <div class="weather-stats">
                    <div class="wx-stat"><span class="wx-label">FEELS</span><span class="wx-value" id="wx-feels">--</span><span class="wx-unit">Â°F</span></div>
                    <div class="wx-stat"><span class="wx-label">HUMID</span><span class="wx-value" id="wx-humidity">--</span><span class="wx-unit">%</span></div>
                    <div class="wx-stat"><span class="wx-label">WIND</span><span class="wx-value" id="wx-wind">--</span><span class="wx-unit">mph</span></div>
                </div>
            </div>
            <div class="weather-forecast">
                <div class="forecast-day"><div class="fc-label">TODAY</div><div class="fc-temps"><span class="hi" id="wx-today-hi">--</span><span class="sep">/</span><span class="lo" id="wx-today-lo">--</span></div></div>
                <div class="forecast-day"><div class="fc-label">TOMORROW</div><div class="fc-temps"><span class="hi" id="wx-tmrw-hi">--</span><span class="sep">/</span><span class="lo" id="wx-tmrw-lo">--</span></div></div>
                <div class="forecast-day"><div class="fc-label">â˜€ RISE</div><div class="fc-value" id="wx-sunrise">--</div></div>
                <div class="forecast-day"><div class="fc-label">ðŸŒ… SET</div><div class="fc-value" id="wx-sunset">--</div></div>
            </div>
            <div class="suggestions" id="wx-suggestions"></div>
        </div>
    </div>

    <!-- Family Activities -->

    <!-- Calendar â€” Expanded by Default -->
    <div class="widget widget-calendar" id="widget-calendar">
        <div class="widget-header" onclick="toggleWidget('widget-calendar')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-calendar-days"></i></div>
                <span>FAMILY CALENDAR</span>
            </div>
            <div class="widget-header-right">
                <div class="cal-source-pills" id="cal-sources"></div>
                <i class="fas fa-chevron-down widget-toggle-icon"></i>
            </div>
        </div>
        <div class="widget-body">
            <div class="calendar-view" id="calendar-view">
                <div class="loading-placeholder">Loading schedules...</div>
            </div>
        </div>
    </div>

    <div class="widget widget-cameras collapsed" id="widget-cameras">
        <div class="widget-header" onclick="toggleWidget('widget-cameras')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-video"></i></div>
                <span>CAMERAS</span>
            </div>
            <div class="widget-header-right">
                <span class="badge badge-red"><div class="badge-dot"></div>LIVE</span>
                <i class="fas fa-chevron-down widget-toggle-icon"></i>
            </div>
        </div>
        <div class="widget-body">
            <div class="camera-grid">
                <div class="camera-feed" onclick="event.stopPropagation(); toggleCameraFullscreen(this)">
                    <img id="cam1" src="/api/cameras/1" alt="Driveway">
                    <div class="camera-hud">
                        <div class="camera-label">CAM-01 <span class="cam-sep">//</span> FRONT PORCH</div>
                        <div class="camera-live"><div class="rec-dot"></div>REC</div>
                    </div>
                    <div class="camera-corners">
                        <div class="corner tl"></div><div class="corner tr"></div>
                        <div class="corner bl"></div><div class="corner br"></div>
                    </div>
                    <div class="camera-scanlines"></div>
                </div>
                <div class="camera-feed" onclick="event.stopPropagation(); toggleCameraFullscreen(this)">
                    <img id="cam2" src="/api/cameras/2" alt="Rear">
                    <div class="camera-hud">
                        <div class="camera-label">CAM-02 <span class="cam-sep">//</span> DRIVEWAY</div>
                        <div class="camera-live"><div class="rec-dot"></div>REC</div>
                    </div>
                    <div class="camera-corners">
                        <div class="corner tl"></div><div class="corner tr"></div>
                        <div class="corner bl"></div><div class="corner br"></div>
                    </div>
                    <div class="camera-scanlines"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Scenes -->
    <div class="widget collapsed" id="widget-scenes">
        <div class="widget-header" onclick="toggleWidget('widget-scenes')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-bolt"></i></div>
                <span>PROTOCOLS</span>
            </div>
            <div class="widget-header-right"><i class="fas fa-chevron-down widget-toggle-icon"></i></div>
        </div>
        <div class="widget-body">
            <div class="scenes-grid" id="scenes-grid">
                <div class="loading-placeholder">Initializing protocols...</div>
            </div>
        </div>
    </div>

    <!-- Lights -->
    <div class="widget collapsed" id="widget-lights">
        <div class="widget-header" onclick="toggleWidget('widget-lights')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-lightbulb"></i></div>
                <span>LIGHTING ARRAY</span>
            </div>
            <div class="widget-header-right"><i class="fas fa-chevron-down widget-toggle-icon"></i></div>
        </div>
        <div class="widget-body">
            <div class="lights-grid" id="lights-grid">
                <div class="loading-placeholder">Scanning zones...</div>
            </div>
        </div>
    </div>

    <!-- Weather -->
    <div class="widget collapsed" id="widget-activities">
        <div class="widget-header" onclick="toggleWidget('widget-activities')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-people-group"></i></div>
                <span>FAMILY OPS</span>
            </div>
            <div class="widget-header-right"><i class="fas fa-chevron-down widget-toggle-icon"></i></div>
        </div>
        <div class="widget-body">
            <div class="activities-list" id="activities-list">
                <div class="loading-placeholder">Analyzing conditions...</div>
            </div>
        </div>
    </div>

    <!-- Media Players -->
    <div class="widget collapsed" id="widget-media">
        <div class="widget-header" onclick="toggleWidget('widget-media')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-headphones"></i></div>
                <span>MEDIA ARRAY</span>
            </div>
            <div class="widget-header-right"><i class="fas fa-chevron-down widget-toggle-icon"></i></div>
        </div>
        <div class="widget-body">
            <div class="media-list" id="media-list">
                <div class="loading-placeholder">Scanning devices...</div>
            </div>
        </div>
    </div>

    <!-- Media Command Center -->
    <div class="widget collapsed" id="widget-media-center">
        <div class="widget-header" onclick="toggleWidget('widget-media-center')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-film"></i></div>
                <span>MEDIA COMMAND</span>
            </div>
            <div class="widget-header-right"><i class="fas fa-chevron-down widget-toggle-icon"></i></div>
        </div>
        <div class="widget-body">
            <!-- Tabs -->
            <div class="mc-tabs">
                <button class="mc-tab active" onclick="mcTab('recent')">RECENT</button>
                <button class="mc-tab" onclick="mcTab('search')">SEARCH</button>
                <button class="mc-tab" onclick="mcTab('add')">ADD NEW</button>
                <button class="mc-tab" onclick="mcTab('recs')">FOR YOU</button>
            </div>
            <!-- Library Stats Bar -->
            <div class="mc-stats" id="mc-stats"></div>
            <!-- Recent -->
            <div class="mc-panel" id="mc-recent">
                <div class="mc-grid" id="mc-recent-grid"></div>
            </div>
            <!-- Search -->
            <div class="mc-panel" id="mc-search" style="display:none;">
                <div class="mc-search-bar">
                    <input type="text" id="mc-search-input" placeholder="Search your Plex library..." onkeydown="if(event.key==='Enter')mcSearch()">
                    <button onclick="mcSearch()"><i class="fas fa-search"></i></button>
                </div>
                <div class="mc-grid" id="mc-search-grid"></div>
            </div>
            <!-- Add New -->
            <div class="mc-panel" id="mc-add" style="display:none;">
                <div class="mc-add-type">
                    <button class="mc-type-btn active" onclick="mcAddType('movie')">ðŸŽ¥ MOVIE</button>
                    <button class="mc-type-btn" onclick="mcAddType('show')">ðŸ“º TV SHOW</button>
                </div>
                <div class="mc-search-bar">
                    <input type="text" id="mc-add-input" placeholder="Search movies to download..." onkeydown="if(event.key==='Enter')mcAddSearch()">
                    <button onclick="mcAddSearch()"><i class="fas fa-search"></i></button>
                </div>
                <div class="mc-grid" id="mc-add-grid"></div>
            </div>
            <!-- Recommendations -->
            <div class="mc-panel" id="mc-recs" style="display:none;">
                <button class="mc-recs-btn" onclick="mcGetRecs()"><i class="fas fa-wand-magic-sparkles"></i> GET RECOMMENDATIONS</button>
                <div id="mc-recs-content"></div>
            </div>
        </div>
    </div>
    <!-- Infrastructure -->
    <div class="widget collapsed" id="widget-infra">
        <div class="widget-header" onclick="toggleWidget('widget-infra')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-server"></i></div>
                <span>SYSTEMS STATUS</span>
            </div>
            <div class="widget-header-right"><i class="fas fa-chevron-down widget-toggle-icon"></i></div>
        </div>
        <div class="widget-body">
            <div class="infra-grid" id="infra-grid">
                <div class="loading-placeholder">Running diagnostics...</div>
            </div>
        </div>
    </div>

    <!-- Alfred Health -->
    <div class="widget collapsed" id="widget-health">
        <div class="widget-header" onclick="toggleWidget('widget-health')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-brain"></i></div>
                <span>ALFRED NEURAL NET</span>
            </div>
            <div class="widget-header-right">
                <span class="badge badge-green" id="health-badge">NOMINAL</span>
                <i class="fas fa-chevron-down widget-toggle-icon"></i>
            </div>
        </div>
        <div class="widget-body">
            <div class="health-grid">
                <div class="health-stat" id="health-memory">
                    <div class="health-ring"><svg viewBox="0 0 36 36"><circle cx="18" cy="18" r="15.9" class="ring-bg"/><circle cx="18" cy="18" r="15.9" class="ring-fill" id="health-ring-fill" style="stroke-dasharray: 46, 100"/></svg><div class="health-ring-value" id="health-mem-pct">46%</div></div>
                    <div class="health-label">MEMORY</div>
                </div>
                <div class="health-stat">
                    <div class="health-value" id="health-uptime">--</div>
                    <div class="health-label">UPTIME</div>
                </div>
                <div class="health-stat">
                    <div class="health-value" id="health-ws">--</div>
                    <div class="health-label">LINK</div>
                </div>
                <div class="health-stat">
                    <div class="health-value" id="health-model">OPUS</div>
                    <div class="health-label">MODEL</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Frigate Events -->
    <div class="widget collapsed" id="widget-frigate">
        <div class="widget-header" onclick="toggleWidget('widget-frigate')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-crosshairs"></i></div>
                <span>MOTION DETECTION</span>
            </div>
            <div class="widget-header-right">
                <span class="badge badge-blue" id="frigate-count">0</span>
                <i class="fas fa-chevron-down widget-toggle-icon"></i>
            </div>
        </div>
        <div class="widget-body">
            <div class="frigate-list" id="frigate-list">
                <div class="loading-placeholder">Scanning perimeter...</div>
            </div>
        </div>
    </div>

    <!-- Network Topology -->
    <div class="widget collapsed" id="widget-topology">
        <div class="widget-header" onclick="toggleWidget('widget-topology')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-diagram-project"></i></div>
                <span>NETWORK MAP</span>
            </div>
            <div class="widget-header-right">
                <span class="badge badge-green" id="topo-device-count">0</span>
                <i class="fas fa-chevron-down widget-toggle-icon"></i>
            </div>
        </div>
        <div class="widget-body">
            <div class="topology-map" id="topology-map">
                <div class="loading-placeholder">Mapping network...</div>
            </div>
        </div>
    </div>

    <!-- Speedtest History -->
    <div class="widget collapsed" id="widget-speedtest">
        <div class="widget-header" onclick="toggleWidget('widget-speedtest')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-gauge-high"></i></div>
                <span>BANDWIDTH</span>
            </div>
            <div class="widget-header-right">
                <button class="speed-run-btn" id="speedtest-btn" onclick="event.stopPropagation(); runSpeedtest()">
                    <i class="fas fa-play"></i> RUN
                </button>
                <i class="fas fa-chevron-down widget-toggle-icon"></i>
            </div>
        </div>
        <div class="widget-body">
            <div class="speedtest-current" id="speedtest-current">
                <div class="speed-stat">
                    <div class="speed-value" id="speed-down">--</div>
                    <div class="speed-label">â†“ DOWNLOAD</div>
                    <div class="speed-unit">Mbps</div>
                </div>
                <div class="speed-stat">
                    <div class="speed-value" id="speed-up">--</div>
                    <div class="speed-label">â†‘ UPLOAD</div>
                    <div class="speed-unit">Mbps</div>
                </div>
                <div class="speed-stat">
                    <div class="speed-value" id="speed-ping">--</div>
                    <div class="speed-label">PING</div>
                    <div class="speed-unit">ms</div>
                </div>
            </div>
            <div class="speedtest-chart" id="speedtest-chart"></div>
        </div>
    </div>

    <!-- Notification Center -->
    <div class="widget collapsed" id="widget-notifications">
        <div class="widget-header" onclick="toggleWidget('widget-notifications')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-bell"></i></div>
                <span>ALERT LOG</span>
            </div>
            <div class="widget-header-right">
                <span class="badge badge-amber" id="notif-count" style="display:none;">0</span>
                <i class="fas fa-chevron-down widget-toggle-icon"></i>
            </div>
        </div>
        <div class="widget-body">
            <div class="notification-list" id="notification-list">
                <div class="notif-empty">No alerts. All quiet on the home front.</div>
            </div>
        </div>
    </div>

    <!-- Quick Timers -->
    <div class="widget collapsed" id="widget-timers">
        <div class="widget-header" onclick="toggleWidget('widget-timers')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-stopwatch"></i></div>
                <span>QUICK TIMERS</span>
            </div>
            <div class="widget-header-right"><i class="fas fa-chevron-down widget-toggle-icon"></i></div>
        </div>
        <div class="widget-body">
            <div class="timer-presets" id="timer-presets">
                <button class="timer-preset-btn" onclick="event.stopPropagation(); startTimer(5, 'Quick Break')">5m</button>
                <button class="timer-preset-btn" onclick="event.stopPropagation(); startTimer(10, 'Focus')">10m</button>
                <button class="timer-preset-btn" onclick="event.stopPropagation(); startTimer(15, 'Homework')">15m</button>
                <button class="timer-preset-btn" onclick="event.stopPropagation(); startTimer(25, 'Pomodoro')">25m</button>
                <button class="timer-preset-btn" onclick="event.stopPropagation(); startTimer(30, 'Cooking')">30m</button>
                <button class="timer-preset-btn" onclick="event.stopPropagation(); startTimer(60, '1 Hour')">60m</button>
                <div class="timer-custom">
                    <input type="number" id="timer-custom-min" class="timer-custom-input" placeholder="Min" min="1" max="180" onclick="event.stopPropagation()">
                    <button class="timer-preset-btn timer-go" onclick="event.stopPropagation(); startCustomTimer()"><i class="fas fa-play"></i></button>
                </div>
            </div>
            <div class="active-timers" id="active-timers"></div>
        </div>
    </div>

    <!-- Talk to Alfred -->
    <div class="widget collapsed" id="widget-chat">
        <div class="widget-header" onclick="toggleWidget('widget-chat')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-terminal"></i></div>
                <span>ALFRED TERMINAL</span>
            </div>
            <div class="widget-header-right"><i class="fas fa-chevron-down widget-toggle-icon"></i></div>
        </div>
        <div class="widget-body">
            <div class="chat-messages" id="chat-messages">
                <div class="chat-msg alfred">
                    <div class="chat-avatar">A</div>
                    <div class="chat-bubble">At your service, sir. Systems nominal. ðŸŽ©</div>
                </div>
            </div>
            <div class="chat-input-row">
                <input type="text" id="chat-input" class="chat-input" placeholder="Enter command..." 
                       onkeydown="if(event.key==='Enter')sendChat()" autocomplete="off" onclick="event.stopPropagation()">
                <button class="chat-send-btn" onclick="event.stopPropagation(); sendChat()"><i class="fas fa-paper-plane"></i></button>
                <button class="chat-voice-btn" onclick="event.stopPropagation(); toggleVoice()" id="chatVoiceBtn">
                    <i class="fas fa-microphone"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Mission Board â€” Full Width -->
    <div class="widget widget-kanban collapsed" id="widget-kanban">
        <div class="widget-header" onclick="toggleWidget('widget-kanban')">
            <div class="widget-header-left">
                <div class="header-icon-wrap"><i class="fas fa-list-check"></i></div>
                <span>MISSION BOARD</span>
            </div>
            <div class="widget-header-right"><i class="fas fa-chevron-down widget-toggle-icon"></i></div>
        </div>
        <div class="widget-body">
            <div class="kanban" id="kanban">
                <div class="kanban-column">
                    <div class="kanban-column-title"><span class="kc-dot todo"></span>QUEUED</div>
                    <div class="kanban-cards" id="kanban-todo"></div>
                </div>
                <div class="kanban-column">
                    <div class="kanban-column-title"><span class="kc-dot progress"></span>ACTIVE</div>
                    <div class="kanban-cards" id="kanban-progress"></div>
                </div>
                <div class="kanban-column">
                    <div class="kanban-column-title"><span class="kc-dot done"></span>COMPLETE</div>
                    <div class="kanban-cards" id="kanban-done"></div>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="/js/app.js"></script>
</body>
</html>
